window.addEventListener("turbolinks:load", () => {
  const card_form = document.querySelector('#card_form');
  if (card_form) {
    card_form.addEventListener("ajax:success", (event) => { 
      const [_data, _status, xhr] = event.detail;
      let xhr_obj = JSON.parse(xhr.response);
      console.log(xhr_obj);

      show_result(xhr_obj);
    });
    card_form.addEventListener("ajax:error", () => {
        document.querySelector("#table_placer").innerText = "Sorry, the server doesn't respond";
    });
  }
});

function show_result(respond) {
  let result = respond.result;
  let user_action = respond.for;
  let card = document.querySelector("#my_card");
  card.querySelector("div.card-footer")?.remove();
  let card_body = document.querySelector("#my_card_body");
  let card_footer = document.createElement("div");
  card.appendChild(card_footer);
  card_footer.classList = "card-footer ";

  let btn_check = document.querySelector("#check_submit");
  let btn_dontrem = document.querySelector("#show_answer_submit");
  let word_input = document.querySelector("#card_word")

  if (user_action === "Check") {
    if (result.status === "correct") {
      card.classList = "card border-success";
      card_body.classList = "card-body text-success";
      card_footer.classList += "text-white bg-success";
      card_footer.innerText = "Correct!";
      word_input.readOnly = true;
      btn_check.hidden = true;
      btn_dontrem.hidden = true;
    }
    else if (result.DL_distance === 1) {
      card.classList = "card border-warning";
      card_body.classList = "card-body";
      card_footer.classList += "bg-warning";
      card_footer.innerHTML = `Almost correct! The right answer is <em>${result.answer}</em>`;
    }
    else {
      card.classList = "card border-danger";
      card_body.classList = "card-body text-danger";
      card_footer.classList += "text-white bg-danger";
      card_footer.innerText = "Not correct!";
    }
  }
  else {
    card.classList = "card border-warning";
    card_body.classList = "card-body";
    card_footer.classList += "bg-warning";
    card_footer.innerHTML = `Correct answer is <em>${result.answer}</em>`;
    btn_check.hidden = true;
    btn_dontrem.hidden = true;
    word_input.readOnly = true;
  }
}